/* Шрифт Harry Potter - подключение скачанного шрифта */
@font-face {
  font-family: 'HarryPotter';
  src: url('/fonts/harry-potter-russian-version-of-gfdtk-regular.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

/* Контейнер страницы */
.alchemy-container {
  min-height: 100vh;
  background: transparent; /* Прозрачный фон, чтобы hero-background был виден */
  position: relative;
  overflow-x: hidden;
}

/* Кнопка управления музыкой */
.alchemy-music-toggle {
  position: fixed;
  top: 90px;
  right: 24px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px) saturate(150%);
  -webkit-backdrop-filter: blur(20px) saturate(150%);
  border: 1px solid rgba(255, 215, 0, 0.3);
  color: #FFD700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  transition: all 0.3s ease;
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.3),
    0 0 20px rgba(255, 215, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.alchemy-music-toggle:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 215, 0, 0.5);
  box-shadow: 
    0 6px 20px rgba(0, 0, 0, 0.4),
    0 0 30px rgba(255, 215, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.15);
  transform: scale(1.05);
}

.alchemy-music-toggle:active {
  transform: scale(0.95);
}

.alchemy-music-toggle svg {
  width: 24px;
  height: 24px;
  filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
  transition: all 0.3s ease;
}

.alchemy-music-toggle:hover svg {
  filter: drop-shadow(0 0 12px rgba(255, 215, 0, 0.8));
}

/* Кнопка режима отладки */
.alchemy-debug-toggle {
  position: fixed;
  top: 90px;
  right: 84px; /* Рядом с кнопкой музыки (48px + 24px + 12px gap) */
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px) saturate(150%);
  -webkit-backdrop-filter: blur(20px) saturate(150%);
  border: 1px solid rgba(255, 0, 0, 0.5);
  color: #ff4444;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  transition: all 0.3s ease;
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.3),
    0 0 20px rgba(255, 0, 0, 0.15),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.alchemy-debug-toggle:hover {
  background: rgba(255, 255, 255, 0.12);
  border-color: rgba(255, 0, 0, 0.7);
  box-shadow: 
    0 6px 20px rgba(0, 0, 0, 0.4),
    0 0 30px rgba(255, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.15);
  transform: scale(1.05);
}

.alchemy-debug-toggle:active {
  transform: scale(0.95);
}

.alchemy-debug-toggle svg {
  width: 24px;
  height: 24px;
  filter: drop-shadow(0 0 8px rgba(255, 0, 0, 0.6));
  transition: all 0.3s ease;
}

.alchemy-debug-toggle:hover svg {
  filter: drop-shadow(0 0 12px rgba(255, 0, 0, 0.8));
}

/* Когда режим отладки активен - более яркая рамка */
.alchemy-debug-toggle.active {
  border-color: rgba(255, 0, 0, 0.9);
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.3),
    0 0 25px rgba(255, 0, 0, 0.4),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  background: rgba(255, 0, 0, 0.1);
}

.alchemy-debug-toggle.active:hover {
  border-color: rgba(255, 0, 0, 1);
  box-shadow: 
    0 6px 20px rgba(0, 0, 0, 0.4),
    0 0 35px rgba(255, 0, 0, 0.5),
    inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.alchemy-container.dark-mode {
  background: #000000; /* Черный фон только в темном режиме */
}

/* Прозрачный Header на странице Alchemy - в 2 раза прозрачнее */
.alchemy-container .header-block {
  background: rgba(20, 20, 30, 0.075) !important; /* В 2 раза прозрачнее (0.15 / 2 = 0.075) */
  backdrop-filter: blur(15px) saturate(120%);
  -webkit-backdrop-filter: blur(15px) saturate(120%);
  border-bottom: 1px solid rgba(255, 255, 255, 0.02);
  padding: 12px 24px 8px 24px !important; /* Те же координаты, что и на других страницах */
}

/* Возвращаем обычный размер иконок на странице Alchemy */
.alchemy-container .header-menu-icon-wrapper {
  width: 72px !important;
  height: 72px !important;
  border-radius: 16px !important;
}

.alchemy-container .header-menu-icon {
  width: 72px !important;
  height: 72px !important;
  border-radius: 16px !important;
}

/* Кнопки меню с теми же координатами, но без подписей */
.alchemy-container .header-menu-item {
  background: rgba(255, 255, 255, 0.01) !important;
  min-height: 90px !important; /* Та же высота, что и на других страницах */
  padding: 8px 4px !important; /* Те же координаты, что и на других страницах */
  gap: 6px !important; /* Тот же gap, что и на других страницах */
  justify-content: flex-start !important; /* Как на других страницах */
}

.alchemy-container .header-menu-item:hover {
  background: rgba(255, 255, 255, 0.03) !important;
}

/* Скрываем подписи к кнопкам на странице Alchemy */
.alchemy-container .header-menu-label {
  display: none !important;
}

/* Скрываем speech bubble для профиля на странице Alchemy */
.alchemy-container .speech-bubble {
  display: none !important;
}

/* Стандартный gap в сетке меню как на других страницах */
.alchemy-container .header-menu-grid {
  gap: 8px !important;
}

/* Hero Section */
.alchemy-hero {
  position: relative;
  width: 100vw;
  height: 100vh;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  overflow: hidden;
  padding-top: 60px; /* Отступ для уменьшенного Header без подписей */
}

/* Контейнер для фонового изображения и интерактивных зон */
.alchemy-image-container {
  position: relative;
  width: 100%;
  max-width: 450px; /* Ограничение ширины для десктопа */
  aspect-ratio: 9 / 16;
  margin: 0 auto; /* Центрирование на десктопе */
  z-index: 1;
  overflow: hidden; /* Скрываем подписи, выходящие за границы картинки */
  /* Гарантируем, что все дочерние элементы масштабируются вместе с контейнером */
  box-sizing: border-box;
}

/* Черный фон для заполнения пустых областей (отдельно от картинки) */
.alchemy-background-fill {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #0a0a0a; /* Черный фон */
  z-index: 0;
}


/* Фоновое изображение - картинка заполняет весь контейнер */
.alchemy-hero-background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: block;
  background-color: #0a0a0a; /* Черный фон для заполнения пустых областей */
  background-image: url('/images/i.webp');
  background-size: contain; /* Вся картинка входит полностью, не обрезается */
  background-position: center center; /* Центрирование картинки */
  background-repeat: no-repeat; /* Картинка не повторяется */
  z-index: 1;
  animation: fadeInBackground 0.8s ease-in-out;
  opacity: 0;
  animation-fill-mode: forwards;
}

@keyframes fadeInBackground {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Эффект параллакса при прокрутке */
@media (prefers-reduced-motion: no-preference) {
  .alchemy-hero-background {
    will-change: transform;
  }
}

/* Приветствие - перемещено вниз */
.alchemy-hero-greeting {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10;
  padding: 15px 30px;
  background: linear-gradient(
    135deg,
    rgba(0, 0, 0, 0.75),
    rgba(26, 26, 26, 0.85)
  );
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-radius: 16px 16px 0 0;
  border: 1px solid rgba(255, 215, 0, 0.3);
  border-bottom: none;
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.5),
    0 0 30px rgba(255, 215, 0, 0.2);
  animation: fadeInGreeting 1s ease-in-out 0.8s;
  animation-fill-mode: both;
  opacity: 0;
  width: fit-content;
  max-width: 90%;
  box-sizing: border-box;
  white-space: normal;
  transition: padding 0.5s ease-in-out, border-radius 0.5s ease-in-out;
}

/* Компактный вид блока приветствия (после скрытия "Добро пожаловать") */
.alchemy-hero-greeting.greeting-compact {
  padding: 10px 30px;
  border-radius: 12px 12px 0 0;
}

.alchemy-hero-subtitle {
  font-family: 'Cinzel', 'Cormorant Garamond', serif;
  color: rgba(255, 215, 0, 0.9);
  font-size: 18px;
  font-weight: 500;
  text-align: center;
  margin: 0;
  letter-spacing: 1px;
  text-shadow: 
    0 0 10px rgba(255, 215, 0, 0.5),
    0 2px 4px rgba(0, 0, 0, 0.8);
}

@keyframes fadeInGreeting {
  0% {
    opacity: 0;
    transform: translateX(-50%) translateY(100px); /* Появляется снизу, оставаясь центрированным */
  }
  100% {
    opacity: 1;
    transform: translateX(-50%) translateY(0); /* Центрируется, остается на месте */
  }
}

.alchemy-hero-title {
  font-family: 'HarryPotter', 'Cinzel', 'Cormorant Garamond', serif;
  font-size: 28px;
  font-weight: 600;
  font-style: italic;
  text-align: center;
  margin: 0 0 15px 0;
  letter-spacing: 5px;
  text-transform: capitalize;
  font-variant: small-caps;
  /* Убрано волнистое подчеркивание */
  /* Магический градиентный текст */
  background: linear-gradient(
    135deg,
    #FFD700 0%,
    #FFA500 25%,
    #FFD700 50%,
    #FFF8DC 75%,
    #FFD700 100%
  );
  background-size: 200% auto;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  color: #FFD700; /* Fallback для браузеров без поддержки */
  /* Многослойное светящееся свечение */
  text-shadow: 
    0 0 10px rgba(255, 215, 0, 0.8),
    0 0 20px rgba(255, 165, 0, 0.6),
    0 0 30px rgba(255, 215, 0, 0.4),
    0 0 40px rgba(255, 215, 0, 0.3),
    0 2px 4px rgba(0, 0, 0, 0.8);
  /* Анимация пульсации свечения */
  animation: magicGlow 3s ease-in-out infinite, gradientShift 4s ease infinite;
  filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
  transition: opacity 0.5s ease-in-out, max-height 0.5s ease-in-out, margin 0.5s ease-in-out;
  overflow: hidden;
}

/* Анимация пульсации свечения */
@keyframes magicGlow {
  0%, 100% {
    text-shadow: 
      0 0 10px rgba(255, 215, 0, 0.8),
      0 0 20px rgba(255, 165, 0, 0.6),
      0 0 30px rgba(255, 215, 0, 0.4),
      0 0 40px rgba(255, 215, 0, 0.3),
      0 2px 4px rgba(0, 0, 0, 0.8);
    filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6));
  }
  50% {
    text-shadow: 
      0 0 20px rgba(255, 215, 0, 1),
      0 0 30px rgba(255, 165, 0, 0.8),
      0 0 40px rgba(255, 215, 0, 0.6),
      0 0 50px rgba(255, 215, 0, 0.5),
      0 0 60px rgba(255, 165, 0, 0.3),
      0 2px 4px rgba(0, 0, 0, 0.8);
    filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.9));
  }
}

/* Анимация движения градиента */
@keyframes gradientShift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

/* Интерактивные зоны - позиционируются через JavaScript для точного совпадения с видимой областью картинки */
.alchemy-interactive-zones {
  position: absolute;
  /* Размеры и позиция устанавливаются через JavaScript для точного совпадения с видимой областью картинки */
  z-index: 5;
  /* Блоки внутри позиционируются относительно этого контейнера (который точно совпадает с видимой областью картинки) */
  box-sizing: border-box;
  animation: fadeInZones 1s ease-in-out 0.8s;
  animation-fill-mode: both;
  opacity: 0;
}

@keyframes fadeInZones {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.artifact-zone {
  position: absolute;
  cursor: pointer;
  border: none; /* Убираем границу, чтобы зона была невидимой */
  background: transparent; /* Прозрачный фон */
  transition: all 0.2s ease;
  z-index: 6;
  box-sizing: border-box; /* Граница включается в размер, чтобы проценты работали правильно */
  /* Зоны полностью невидимы, только подписи видны */
  pointer-events: auto; /* Кликабельные - вся зона кликабельна */
  /* Элемент виден для браузера, чтобы получать события, но визуально невидим (без границы и фона) */
  visibility: visible;
}

/* Режим отладки - показывает зоны с полупрозрачным фоном */
.alchemy-container.debug-mode .artifact-zone,
.artifact-zone.debug-visible {
  visibility: visible !important;
  background: rgba(255, 0, 0, 0.1) !important; /* Полупрозрачный красный фон */
  border: none !important; /* Убираем красную рамку отладки */
}

/* В режиме отладки подсвечиваем также картинку свечи,
   чтобы было проще подбирать координаты */
.alchemy-container.debug-mode .alchemy-candle-image {
  outline: 2px solid rgba(255, 0, 0, 0.7);
  box-shadow: 0 0 10px rgba(255, 0, 0, 0.7);
}

/* В режиме отладки подписи также видимы поверх зон */
.alchemy-container.debug-mode .artifact-zone::after,
.artifact-zone.debug-visible::after {
  background: rgba(255, 255, 255, 0.95) !important;
  border: none !important; /* Убираем красную рамку отладки */
  color: #000 !important;
  font-weight: 700 !important;
  z-index: 11 !important;
  box-shadow: none !important; /* Убираем красное свечение отладки */
}

/* Подпись артефакта - всегда видимая, внизу зоны */
.artifact-zone::after {
  content: attr(title);
  position: absolute;
  bottom: 8%; /* Располагаем подпись ближе к нижнему краю зоны */
  left: 50%;
  transform: translateX(-50%); /* Центрируем по горизонтали */
  padding: 6px 12px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  color: #FFD700;
  font-size: 13px;
  font-weight: 600;
  border-radius: 6px;
  white-space: nowrap;
  opacity: 0.9; /* Всегда видимая */
  visibility: visible; /* Явно делаем видимой */
  pointer-events: auto; /* Кликабельная */
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 215, 0, 0.5);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6), 0 0 15px rgba(255, 215, 0, 0.3);
  z-index: 10;
  cursor: pointer;
  text-shadow: 0 0 8px rgba(255, 215, 0, 0.6);
  letter-spacing: 0.5px;
}

/* Зоны остаются невидимыми даже при наведении */
.artifact-zone:hover {
  background: transparent; /* Остается невидимой */
  border: none; /* Без границы */
  transform: none; /* Без трансформации */
}

.artifact-zone:hover::after {
  visibility: visible; /* Подпись остается видимой при наведении */
}

/* Подпись при наведении становится ярче */
.artifact-zone:hover::after {
  opacity: 1;
  background: rgba(255, 255, 255, 0.15);
  border-color: rgba(255, 215, 0, 0.9);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.8), 0 0 20px rgba(255, 215, 0, 0.6);
  transform: translateX(-50%) scale(1.08); /* Обновлен transform для новой позиции */
}

/* Убираем transform у элементов с translateX при hover, чтобы подпись не улетала */
.artifact-amulets:hover {
  transform: translateX(-50%) !important;
}

/* Расположение зон на изображении с учетом соотношения 9:16 (вертикальный формат) */
/* Позиции пересчитаны из пикселей в проценты для адаптивности */
/* Все проценты рассчитываются относительно размера родительского контейнера .alchemy-image-container */
.artifact-mirror {
  top: 1.875%;
  left: 16.94%;
  width: 44.44%; /* 200px / 450px * 100 */
  height: 18.75%; /* 150px / 800px * 100 */
}

.artifact-crystal {
  top: 10.11%; /* 80.913px / 800px * 100 */
  left: 67.11%; /* 302px / 450px * 100 */
  width: 28.89%; /* 130px / 450px * 100 */
  height: 20%; /* 160px / 800px * 100 */
}

.artifact-astrolabe {
  top: 30.78%;
  left: 21.11%; /* Процент от ширины контейнера - масштабируется автоматически */
  width: 55.56%; /* Процент от ширины контейнера - масштабируется автоматически */
  height: 30%; /* Процент от высоты контейнера - масштабируется автоматически */
}

.artifact-candle {
  top: 14%;  /* Синхронизировано с положением пламени свечи (предыдущее значение) */
  left: 4.5%; /* Синхронизировано с положением пламени свечи (предыдущее значение) */
  width: 20%; /* Процент от ширины контейнера */
  height: 20%; /* Процент от высоты контейнера */
  /* Легкое свечение от свечи */
  filter: drop-shadow(0 0 4px rgba(255, 170, 0, 0.2));
  z-index: 7; /* Выше астролябии (z-index: 6), чтобы можно было кликнуть */
}

/* Анимированная свеча (GIF/WEBP), наложенная поверх стола.
   Находится в том же контейнере с aspect-ratio 9/16, что и фон,
   поэтому проценты считаются от одной и той же базы. */
.alchemy-candle-image {
  position: absolute;
  left: 3.5%;   /* Предыдущее выровненное значение по X */
  top: 17%;     /* Предыдущее выровненное значение по Y */
  width: 21%;   /* Предыдущее значение ширины */
  pointer-events: none; /* Клики проходят сквозь картинку к артефакту */
  z-index: 5;
  animation: fadeInCandle 1s ease-in-out 0.8s;
  animation-fill-mode: both;
  opacity: 0;
}

@keyframes fadeInCandle {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.artifact-snitch {
  top: 40%; /* Позиция снитча */
  left: 88%; /* Увеличено на 10% с 78% */
  width: 11%; /* Процент от ширины контейнера - масштабируется автоматически */
  height: 11.47%; /* Увеличено еще на 30% с 8.82% */
}

.artifact-tarot {
  top: 60.375%; /* Процент от высоты контейнера - масштабируется автоматически */
  left: 2%; /* Сдвинуто внутрь чтобы подпись не выходила за левую границу (было -12%) */
  width: 44.44%; /* Изменено с 76% (342px) на 44.44% (200px при max-width 450px) */
  height: 20.53%; /* Процент от высоты контейнера - масштабируется автоматически */
}

.artifact-hourglass {
  top: 62.5%; /* 500px / 800px * 100 */
  left: 55.56%; /* 250px / 450px * 100 */
  width: 14%;
  height: 22.5%; /* 180px / 800px * 100 */
}

.artifact-chalice {
  top: 57.5%; /* 460px / 800px * 100 */
  left: 82.78%; /* Увеличено на 10% с 72.78% относительно всего контейнера */
  width: 22.22%; /* 100px / 450px * 100 */
  height: 25%; /* 200px / 800px * 100 */
}

.artifact-amulets {
  bottom: 7%;
  left: 50%;
  transform: translateX(-50%);
  width: 70%;
  height: 8%;
}

/* Секция действий */
.action-zone {
  position: fixed; /* Фиксируем позицию, чтобы нельзя было прокрутить к столу */
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100vh;
  max-height: 100vh;
  overflow: hidden; /* Отключаем прокрутку - к столу возвращаемся только кнопкой */
  background: #1a1a1a;
  background: linear-gradient(135deg, #1a1a1a, #0f0f0f);
  padding: 120px 20px 0; /* Отступ сверху для header (12px padding + 90px min-height + 8px padding + запас) */
  z-index: 20;
  display: block;
}

/* Астрологический фон для астролябии - звездное небо с созвездиями */
.action-zone-astrolabe .action-zone-content {
  background-image: 
    /* Мелкие звезды */
    url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='small-stars' width='200' height='200' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='30' cy='40' r='0.5' fill='rgba(255,255,255,0.6)'/%3E%3Ccircle cx='80' cy='25' r='0.5' fill='rgba(255,255,255,0.5)'/%3E%3Ccircle cx='150' cy='60' r='0.5' fill='rgba(255,255,255,0.6)'/%3E%3Ccircle cx='50' cy='120' r='0.5' fill='rgba(255,255,255,0.4)'/%3E%3Ccircle cx='170' cy='140' r='0.5' fill='rgba(255,255,255,0.5)'/%3E%3Ccircle cx='40' cy='180' r='0.5' fill='rgba(255,255,255,0.6)'/%3E%3Ccircle cx='130' cy='190' r='0.5' fill='rgba(255,255,255,0.4)'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='200' height='200' fill='url(%23small-stars)'/%3E%3C/svg%3E"),
    /* Большие звезды и созвездия */
    url("data:image/svg+xml,%3Csvg width='300' height='300' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='constellations' width='300' height='300' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='50' cy='50' r='1.5' fill='rgba(255,255,255,0.8)'/%3E%3Ccircle cx='150' cy='80' r='1.5' fill='rgba(255,255,255,0.7)'/%3E%3Ccircle cx='250' cy='60' r='1.5' fill='rgba(255,255,255,0.8)'/%3E%3Ccircle cx='80' cy='180' r='1.5' fill='rgba(255,255,255,0.7)'/%3E%3Ccircle cx='200' cy='200' r='2' fill='rgba(255,255,255,0.9)'/%3E%3Ccircle cx='280' cy='240' r='1.5' fill='rgba(255,255,255,0.8)'/%3E%3Cpath d='M 50 50 L 150 80 L 250 60' stroke='rgba(255,215,0,0.15)' stroke-width='0.5' fill='none'/%3E%3Cpath d='M 80 180 L 200 200 L 280 240' stroke='rgba(255,215,0,0.12)' stroke-width='0.5' fill='none'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='300' height='300' fill='url(%23constellations)'/%3E%3C/svg%3E"),
    /* Туманности и градиенты */
    radial-gradient(circle at 20% 30%, rgba(138, 43, 226, 0.15), transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(0, 100, 255, 0.12), transparent 50%),
    radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.08), transparent 60%),
    /* Базовый темный градиент */
    linear-gradient(180deg, #000000, #0a0a0f, #0c0c14);
  background-color: #0a0a0f;
}

.action-zone-inner {
  max-width: 800px;
  width: 100%;
  margin: 0 auto;
  min-height: 100%;
  max-height: calc(100vh - 120px); /* Ограничиваем высоту для появления скролла */
  overflow-y: auto; /* Включаем прокрутку внутри контента - форма и результаты прокручиваются вместе */
  overflow-x: hidden;
  padding: 0 20px 120px; /* Увеличен отступ снизу для кнопки и контента */
  /* Показываем тонкую полосу прокрутки */
  scrollbar-width: thin;
  scrollbar-color: rgba(255, 215, 0, 0.3) rgba(255, 255, 255, 0.1);
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  /* Make this a positioned container so absolutely positioned
     controls (back button) can be anchored to the inner area's bottom
     without overlapping the answer options. Previously the button
     was sticky which in some flows caused it to float over the answers. */
  position: relative;
}

/* Make the back-to-table button sit after all content and pinned near
   the bottom of the scrollable inner area. Use position:sticky so the
   button remains anchored to the inner scroll container and will not
   overlap the absolutely-positioned answer options which are anchored
   to .question-content. Keep the button's stacking order below the
   answer-options (which use z-index:80) so the options remain fully
   visible above the button. */
.action-zone-inner .back-to-table-button {
  position: sticky;
  bottom: 12px; /* small offset from bottom of visible inner area */
  margin: 12px auto 0; /* center via auto margins when inside a flex/flow container */
  z-index: 70; /* below .answer-options (z-index:80) so options stay above */
  /* Let the button size itself to the label for a harmonious look. Use
     inline-flex so padding controls the visual width and text doesn't
     wrap. Keep a sensible max-width to avoid overflow on very small
     containers. */
  display: inline-flex;
  width: auto;
  max-width: 90%;
  align-items: center;
  justify-content: center;
  white-space: nowrap;
}

/* Wrapper to explicitly center the back button in all flows where we render it
   inside a container. This ensures horizontal centering even if some ancestor
   applies positioning. */
.back-to-table-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  box-sizing: border-box;
}

/* Ensure when inputs are focused we keep the button hidden as before */
.action-zone.input-focused .back-to-table-button {
  opacity: 0;
  pointer-events: none;
  transform: translateY(20px);
}

.action-zone-inner::-webkit-scrollbar {
  width: 6px;
}

.action-zone-inner::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 3px;
}

.action-zone-inner::-webkit-scrollbar-thumb {
  background: rgba(255, 215, 0, 0.3);
  border-radius: 3px;
}

.action-zone-inner::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 215, 0, 0.5);
}

/* Контент по умолчанию */
.action-zone-default {
  text-align: center;
  padding: 60px 20px;
  animation: fadeInContent 0.5s ease-in-out; /* Та же анимация снизу */
  max-width: 450px; /* Ограничиваем максимальной шириной фоновой картинки, чтобы панель не выходила на черные полосы */
  width: 100%;
  margin: 0 auto; /* Центрируем */
  box-sizing: border-box;
}

.action-zone-text {
  color: rgba(255, 255, 255, 0.9);
  font-size: 18px;
  line-height: 1.8;
  margin: 0;
}

/* Фиксированный размер шрифта для текста в блоке "Выберите артефакт" */
.action-zone-default .action-zone-text {
  font-size: 18px !important; /* Всегда 18px, независимо от ширины экрана */
}

/* Динамический контент */
.action-zone-content {
  background: rgba(255, 255, 255, 0.03);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 40px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
  animation: fadeInContent 0.5s ease-in-out;
  max-width: 450px; /* Ограничиваем максимальной шириной фоновой картинки, чтобы панель не выходила на черные полосы */
  width: 100%;
  margin: 0 auto; /* Центрируем */
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  min-height: fit-content; /* Высота подстраивается под контент */
  max-height: none; /* Убираем ограничение высоты для карт Таро */
  overflow: visible; /* Разрешаем показ всего контента */
}

/* Для астролябии (калькулятора) убираем ограничение высоты и overflow */
.action-zone-astrolabe .action-zone-content {
  max-height: none;
  overflow: visible;
  max-width: 800px;
}

/* Для карт Таро убираем ограничение высоты и overflow, чтобы все элементы поместились */
.action-zone-tarot .action-zone-content {
  max-height: none;
  overflow: visible;
  min-height: fit-content;
}

/* Для геймификации обучения убираем ограничение высоты и overflow, чтобы все элементы поместились */
.action-zone-snitch .action-zone-content {
  max-height: none;
  overflow: visible;
  min-height: fit-content;
}

/* ============================================
   ВАРИАНТЫ ФОНОВ ДЛЯ КАРТ ТАРО
   ============================================
   
   ВАРИАНТ 1: Магический фон с пентаграммой, луной и кристаллами
   ВАРИАНТ 2 (ТЕКУЩИЙ): Серьезный темный фон с глубокими градиентами
   ВАРИАНТ 3: Космические туманности (более фиолетовые)
   ВАРИАНТ 4: Руны и эзотерические символы
   ВАРИАНТ 5: Минималистичный с градиентами
   
   Чтобы использовать другой вариант, замените содержимое ниже
   ============================================ */


/* ВАРИАНТ 2: Дым/туман с магическими символами (закомментирован - слишком детский)
.action-zone-tarot .action-zone-content {
  background-image: 
    url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='smoke' width='200' height='200' patternUnits='userSpaceOnUse'%3E%3Cellipse cx='50' cy='50' rx='30' ry='40' fill='rgba(138,43,226,0.08)'/%3E%3Cellipse cx='150' cy='100' rx='25' ry='35' fill='rgba(75,0,130,0.06)'/%3E%3Cellipse cx='100' cy='150' rx='20' ry='30' fill='rgba(138,43,226,0.07)'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='200' height='200' fill='url(%23smoke)'/%3E%3C/svg%3E"),
    url("data:image/svg+xml,%3Csvg width='300' height='300' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='symbols' width='300' height='300' patternUnits='userSpaceOnUse'%3E%3Cpath d='M 150 50 L 170 90 L 150 110 L 130 90 Z' fill='none' stroke='rgba(138,43,226,0.15)' stroke-width='1'/%3E%3Ccircle cx='150' cy='200' r='20' fill='none' stroke='rgba(138,43,226,0.12)' stroke-width='1'/%3E%3Cpath d='M 80 150 L 100 180 L 80 200 L 60 180 Z' fill='none' stroke='rgba(0,191,255,0.15)' stroke-width='1'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='300' height='300' fill='url(%23symbols)'/%3E%3C/svg%3E"),
    radial-gradient(circle at 25% 25%, rgba(138, 43, 226, 0.25), transparent 55%),
    radial-gradient(circle at 75% 75%, rgba(75, 0, 130, 0.2), transparent 55%),
    linear-gradient(180deg, #0d0520, #150a30, #1a0f35);
  background-color: #0d0520;
  border: 1px solid rgba(138, 43, 226, 0.35);
  box-shadow: 
    0 8px 32px rgba(138, 43, 226, 0.35),
    0 0 45px rgba(138, 43, 226, 0.12);
}
*/

/* ВАРИАНТ 2: Звездное небо (как на астролябии, но с фиолетовыми акцентами для карт Таро) */
.action-zone-tarot .action-zone-content {
  background-image: 
    /* Мелкие звезды */
    url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='small-stars-tarot' width='200' height='200' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='30' cy='40' r='0.5' fill='rgba(255,255,255,0.6)'/%3E%3Ccircle cx='80' cy='25' r='0.5' fill='rgba(255,255,255,0.5)'/%3E%3Ccircle cx='150' cy='60' r='0.5' fill='rgba(255,255,255,0.6)'/%3E%3Ccircle cx='50' cy='120' r='0.5' fill='rgba(255,255,255,0.4)'/%3E%3Ccircle cx='170' cy='140' r='0.5' fill='rgba(255,255,255,0.5)'/%3E%3Ccircle cx='40' cy='180' r='0.5' fill='rgba(255,255,255,0.6)'/%3E%3Ccircle cx='130' cy='190' r='0.5' fill='rgba(255,255,255,0.4)'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='200' height='200' fill='url(%23small-stars-tarot)'/%3E%3C/svg%3E"),
    /* Большие звезды и созвездия */
    url("data:image/svg+xml,%3Csvg width='300' height='300' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='constellations-tarot' width='300' height='300' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='50' cy='50' r='1.5' fill='rgba(255,255,255,0.8)'/%3E%3Ccircle cx='150' cy='80' r='1.5' fill='rgba(255,255,255,0.7)'/%3E%3Ccircle cx='250' cy='60' r='1.5' fill='rgba(255,255,255,0.8)'/%3E%3Ccircle cx='80' cy='180' r='1.5' fill='rgba(255,255,255,0.7)'/%3E%3Ccircle cx='200' cy='200' r='2' fill='rgba(255,255,255,0.9)'/%3E%3Ccircle cx='280' cy='240' r='1.5' fill='rgba(255,255,255,0.8)'/%3E%3Cpath d='M 50 50 L 150 80 L 250 60' stroke='rgba(138,43,226,0.15)' stroke-width='0.5' fill='none'/%3E%3Cpath d='M 80 180 L 200 200 L 280 240' stroke='rgba(138,43,226,0.12)' stroke-width='0.5' fill='none'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='300' height='300' fill='url(%23constellations-tarot)'/%3E%3C/svg%3E"),
    /* Туманности и градиенты с фиолетовыми акцентами */
    radial-gradient(circle at 20% 30%, rgba(138, 43, 226, 0.15), transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(75, 0, 130, 0.12), transparent 50%),
    radial-gradient(circle at 50% 50%, rgba(138, 43, 226, 0.08), transparent 60%),
    /* Базовый темный градиент */
    linear-gradient(180deg, #000000, #0a0a0f, #0c0c14);
  background-color: #0a0a0f;
  border: 1px solid rgba(138, 43, 226, 0.3);
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.6),
    0 0 60px rgba(138, 43, 226, 0.15),
    inset 0 0 100px rgba(138, 43, 226, 0.03);
}

/* ВАРИАНТ 3: Космические туманности (более фиолетовые) (закомментирован)
.action-zone-tarot .action-zone-content {
  background-image: 
    url("data:image/svg+xml,%3Csvg width='250' height='250' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='nebula' width='250' height='250' patternUnits='userSpaceOnUse'%3E%3Cellipse cx='60' cy='60' rx='50' ry='40' fill='rgba(138,43,226,0.12)'/%3E%3Cellipse cx='190' cy='120' rx='45' ry='50' fill='rgba(75,0,130,0.1)'/%3E%3Cellipse cx='125' cy='190' rx='40' ry='45' fill='rgba(138,43,226,0.1)'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='250' height='250' fill='url(%23nebula)'/%3E%3C/svg%3E"),
    radial-gradient(circle at 20% 30%, rgba(138, 43, 226, 0.3), transparent 65%),
    radial-gradient(circle at 80% 70%, rgba(75, 0, 130, 0.25), transparent 65%),
    radial-gradient(circle at 50% 50%, rgba(0, 191, 255, 0.15), transparent 75%),
    linear-gradient(135deg, #0a0515, #1a0f2a, #2a1f3a);
  background-color: #0a0515;
  border: 1px solid rgba(138, 43, 226, 0.4);
  box-shadow: 
    0 8px 32px rgba(138, 43, 226, 0.4),
    0 0 60px rgba(138, 43, 226, 0.2);
}
*/

/* ВАРИАНТ 4: Руны и эзотерические символы (закомментирован)
.action-zone-tarot .action-zone-content {
  background-image: 
    url("data:image/svg+xml,%3Csvg width='180' height='180' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='runes' width='180' height='180' patternUnits='userSpaceOnUse'%3E%3Cpath d='M 90 20 L 110 60 L 90 80 L 70 60 Z' fill='none' stroke='rgba(138,43,226,0.2)' stroke-width='1.5'/%3E%3Cpath d='M 50 100 L 70 140 L 50 160 L 30 140 Z' fill='none' stroke='rgba(138,43,226,0.15)' stroke-width='1'/%3E%3Cpath d='M 130 100 L 150 140 L 130 160 L 110 140 Z' fill='none' stroke='rgba(0,191,255,0.2)' stroke-width='1.5'/%3E%3Cline x1='90' y1='40' x2='90' y2='100' stroke='rgba(138,43,226,0.15)' stroke-width='1'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='180' height='180' fill='url(%23runes)'/%3E%3C/svg%3E"),
    radial-gradient(circle at 30% 25%, rgba(138, 43, 226, 0.18), transparent 50%),
    radial-gradient(circle at 70% 75%, rgba(0, 191, 255, 0.15), transparent 50%),
    linear-gradient(180deg, #0f0a20, #1a0f30);
  background-color: #0f0a20;
  border: 1px solid rgba(138, 43, 226, 0.3);
  box-shadow: 
    0 8px 32px rgba(138, 43, 226, 0.3),
    0 0 40px rgba(138, 43, 226, 0.1);
}
*/

/* ВАРИАНТ 5: Минималистичный с градиентами (закомментирован)
.action-zone-tarot .action-zone-content {
  background-image: 
    radial-gradient(circle at 25% 30%, rgba(138, 43, 226, 0.25), transparent 60%),
    radial-gradient(circle at 75% 70%, rgba(75, 0, 130, 0.2), transparent 60%),
    radial-gradient(circle at 50% 50%, rgba(0, 191, 255, 0.15), transparent 70%),
    linear-gradient(135deg, #0a0515, #150a25, #1f0f35);
  background-color: #0a0515;
  border: 1px solid rgba(138, 43, 226, 0.35);
  box-shadow: 
    0 8px 32px rgba(138, 43, 226, 0.35),
    0 0 50px rgba(138, 43, 226, 0.15);
}
*/

/* Специальные стили для зеркала - переопределяем фон */
.action-zone-mirror.action-zone-content {
  background-image: 
    /* Звездное небо */
    url("data:image/svg+xml,%3Csvg width='200' height='200' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='stars' width='200' height='200' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='30' cy='40' r='1' fill='rgba(255,255,255,0.3)'/%3E%3Ccircle cx='80' cy='25' r='0.8' fill='rgba(255,255,255,0.25)'/%3E%3Ccircle cx='150' cy='60' r='1.2' fill='rgba(255,255,255,0.35)'/%3E%3Ccircle cx='50' cy='120' r='0.9' fill='rgba(255,255,255,0.3)'/%3E%3Ccircle cx='170' cy='140' r='1' fill='rgba(255,255,255,0.25)'/%3E%3Ccircle cx='40' cy='180' r='1.1' fill='rgba(255,255,255,0.3)'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='200' height='200' fill='url(%23stars)'/%3E%3C/svg%3E"),
    /* Космические туманности */
    radial-gradient(circle at 20% 30%, rgba(138, 43, 226, 0.15), transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(75, 0, 130, 0.12), transparent 50%),
    radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.08), transparent 60%),
    /* Базовый темный градиент */
    linear-gradient(180deg, #000000, #0a0a0f, #0c0c14);
  background-color: #0a0a0f;
  border: 1px solid rgba(255, 215, 0, 0.2);
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.6),
    0 0 60px rgba(138, 43, 226, 0.2),
    inset 0 0 100px rgba(255, 215, 0, 0.05);
}

@keyframes fadeInContent {
  0% {
    opacity: 0;
    transform: translateY(100px); /* Начальная позиция снизу экрана */
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.action-zone-title {
  color: #FFD700;
  font-size: 28px;
  font-weight: 700;
  text-align: center;
  margin: 0 0 20px;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.action-zone-content .action-zone-text {
  color: rgba(255, 255, 255, 0.85);
  font-size: 16px;
  line-height: 1.8;
  margin: 0 0 30px;
  text-align: center;
}

/* Группы ввода */
.action-zone-input-group {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-top: 30px;
  margin-bottom: 20px;
}

.action-zone-input {
  width: 100%;
  padding: 15px 20px;
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  color: #ffffff;
  font-size: 16px;
  outline: none;
  transition: all 0.3s ease;
  box-sizing: border-box;
}

.action-zone-input::placeholder {
  color: rgba(255, 255, 255, 0.4);
}

.action-zone-input:focus {
  border-color: rgba(255, 215, 0, 0.5);
  background: rgba(255, 255, 255, 0.08);
  box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
}

.action-zone-input[type="date"],
.action-zone-input[type="number"] {
  color-scheme: dark;
}

/* Кнопки */
.action-zone-button {
  width: 100%;
  padding: 15px 30px;
  background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.15));
  border: 2px solid rgba(255, 215, 0, 0.5);
  border-radius: 12px;
  color: #FFD700;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
}

.action-zone-button:hover {
  background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.25));
  border-color: rgba(255, 215, 0, 0.8);
  box-shadow: 
    0 0 30px rgba(255, 215, 0, 0.4),
    0 4px 16px rgba(255, 215, 0, 0.2);
  transform: translateY(-2px);
}

.action-zone-button:active {
  transform: translateY(0);
}

/* Карты */
.tarot-cards-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 16px;
  margin-top: 30px;
  perspective: 1000px;
  justify-items: center;
  width: 100%;
  box-sizing: border-box;
  min-height: 0;
  visibility: visible !important; /* Принудительно делаем видимым */
  opacity: 1 !important; /* Принудительно делаем непрозрачным */
}

/* Контейнер для карты с 3D эффектом */
.tarot-card-wrapper {
  width: 100%;
  aspect-ratio: 2/3;
  max-width: 100%;
  min-height: 0;
  height: auto;
  cursor: pointer;
  position: relative;
  transition: all 0.3s ease;
  visibility: visible !important; /* Принудительно делаем видимым */
  opacity: 1 !important; /* Принудительно делаем непрозрачным */
  display: block !important; /* Принудительно делаем блочным */
}

.tarot-card-wrapper.disabled {
  opacity: 0.3;
  cursor: not-allowed;
  pointer-events: none;
}

.tarot-card-wrapper:not(.disabled):not(.flipped):hover {
  transform: translateY(-8px);
}

/* Внутренний контейнер для переворота */
.tarot-card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
  transition: transform 0.8s cubic-bezier(0.4, 0.2, 0.2, 1);
}

.tarot-card-wrapper.flipped .tarot-card-inner {
  transform: rotateY(180deg);
}

/* Лицевая и обратная стороны карты */
.tarot-card-front,
.tarot-card-back {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  min-height: 0;
  backface-visibility: hidden;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);
}

.tarot-card-front {
  z-index: 2;
}

.tarot-card-back {
  transform: rotateY(180deg);
  z-index: 1;
}

.tarot-card-image {
  width: 100%;
  height: 100%;
  min-height: 0;
  display: block;
  object-fit: cover;
  border-radius: 12px;
}

/* Glassmorphism эффект при наведении */
.tarot-card-wrapper:not(.disabled):not(.flipped):hover .tarot-card-front {
  box-shadow: 
    0 8px 32px rgba(138, 43, 226, 0.4),
    0 0 40px rgba(255, 215, 0, 0.3),
    inset 0 0 20px rgba(255, 215, 0, 0.1);
  backdrop-filter: blur(10px);
}

/* Эффект для перевернутой карты */
.tarot-card-wrapper.flipped .tarot-card-back {
  box-shadow: 
    0 12px 40px rgba(138, 43, 226, 0.5),
    0 0 60px rgba(255, 215, 0, 0.4),
    inset 0 0 30px rgba(255, 215, 0, 0.15);
}

.tarot-result {
  margin-top: 40px;
  padding: 30px;
  background: rgba(138, 43, 226, 0.1);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid rgba(138, 43, 226, 0.3);
  border-radius: 16px;
  box-shadow: 
    0 8px 32px rgba(138, 43, 226, 0.2),
    inset 0 0 40px rgba(255, 215, 0, 0.05);
  animation: fadeInContent 0.5s ease-in-out;
}

.tarot-result-text {
  color: rgba(255, 255, 255, 0.95);
  text-align: left;
  font-size: 16px;
  line-height: 1.8;
  margin: 0;
  white-space: pre-line;
}

/* Амулеты */
.amulets-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
  margin-top: 30px;
}

.amulet-button {
  padding: 20px 15px;
  background: linear-gradient(135deg, rgba(0, 209, 255, 0.2), rgba(0, 150, 255, 0.15));
  border: 2px solid rgba(0, 209, 255, 0.5);
  border-radius: 12px;
  color: #00D1FF;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
}

.amulet-button:hover {
  background: linear-gradient(135deg, rgba(0, 209, 255, 0.3), rgba(0, 150, 255, 0.25));
  border-color: rgba(0, 209, 255, 0.8);
  box-shadow: 0 0 20px rgba(0, 209, 255, 0.4);
  transform: translateY(-2px);
}

/* Обертка для MatrixCalculator */
.matrix-calculator-wrapper {
  margin-top: 30px;
  width: 100%;
  box-sizing: border-box;
  overflow: visible;
}

/* Кнопка "Вернуться к столу" */
.back-to-table-button {
  /* Use absolute positioning so the button respects the nearest positioned
     ancestor. In the tests/diagnostics flow the answers area reserves space
     via --diagnostics-answer-area-height and parent wrappers may be fixed.
     Using absolute avoids the button ignoring a fixed wrapper (regression
     where both wrapper and button were fixed, causing overlap with answers). */
  position: relative; /* default inside .action-zone-inner; fixed instances use .fixed-back-to-table */
  bottom: auto;
  height: var(--back-to-table-button-height, 56px);
  left: 50%;
  transform: translateX(-50%);
  /* Let width be driven by content; padding gives the visual rhythm. */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: auto;
  padding: 10px 20px;
  background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.15));
  border: 2px solid rgba(255, 215, 0, 0.5);
  border-radius: 20px;
  color: #FFD700;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 100;
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.4),
    0 0 20px rgba(255, 215, 0, 0.2);
}

/* Helper used when the back button must be fixed relative to viewport
   (used in the standalone-IKIGAI overlay case). It respects the CSS
   variable --diagnostics-answer-area-height so it won't overlap answer
   options — keep a small gap above the button. */
.fixed-back-to-table {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  /* push the fixed back button slightly lower than the reserved answers area
     so it won't visually overlap the answer options on most devices */
  bottom: calc(var(--diagnostics-answer-area-height, 140px) + 24px);
  /* keep the button visually below the answer options (which use z-index:80) */
  z-index: 60;
}

/* Скрываем кнопку "Вернуться к столу" когда поле ввода в фокусе */
.action-zone.input-focused .back-to-table-button {
  opacity: 0;
  pointer-events: none;
  transform: translateX(-50%) translateY(20px);
}

.back-to-table-button:hover {
  background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.25));
  border-color: rgba(255, 215, 0, 0.8);
  box-shadow: 
    0 6px 20px rgba(0, 0, 0, 0.5),
    0 0 30px rgba(255, 215, 0, 0.4);
  transform: translateX(-50%) translateY(-2px);
}

.back-to-table-button:active {
  transform: translateX(-50%) translateY(0);
}

/* Адаптивность для планшетов */
@media (max-width: 1024px) {
  /* Дополнительные стили для Header на планшетах */
  .alchemy-container .header-block {
    background: rgba(20, 20, 30, 0.075) !important; /* Прозрачность в 2 раза меньше */
    padding: 12px 24px 8px 24px !important; /* Стандартный padding как на других страницах */
  }

  .alchemy-container .header-menu-icon-wrapper {
    width: 64px !important;
    height: 64px !important;
    border-radius: 14px !important;
  }

  .alchemy-container .header-menu-icon {
    width: 64px !important;
    height: 64px !important;
    border-radius: 14px !important;
  }

  .alchemy-container .header-menu-item {
    min-height: 85px !important;
    padding: 8px 4px !important;
    gap: 6px !important;
  }

  .alchemy-container .header-menu-label {
    display: none !important;
  }

  .alchemy-container .header-menu-grid {
    gap: 8px !important; /* Стандартный gap как на других страницах */
  }

  .alchemy-hero {
    padding-top: 60px; /* Уменьшенный отступ для планшетов */
  }

  .alchemy-music-toggle {
    top: 75px;
    right: 20px;
    width: 44px;
    height: 44px;
  }

  .alchemy-music-toggle svg {
    width: 22px;
    height: 22px;
  }

  .alchemy-hero-title {
    font-size: 24px;
    letter-spacing: 1.5px;
  }

  .action-zone-title {
    font-size: 24px;
  }

  .tarot-cards-container,
  .amulets-container {
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
  }
  
  .tarot-card-wrapper {
    max-width: 100%;
    min-height: 0;
    height: auto;
  }
  
  .tarot-card-front,
  .tarot-card-back {
    min-height: 0;
    height: 100%;
  }
  
  .tarot-card-image {
    min-height: 0;
    height: 100%;
  }

  /* Позиции artifact-zone универсальны для всех устройств (используются проценты с соотношением 9:16) */
}

/* Адаптивность для мобильных устройств */
@media (max-width: 768px) {
  /* Дополнительные стили для Header на мобильных */
  .alchemy-container .header-block {
    background: rgba(20, 20, 30, 0.075) !important; /* Прозрачность в 2 раза меньше */
    padding: 10px 16px 6px 16px !important; /* Стандартный padding как на других страницах */
  }

  .alchemy-container .header-menu-icon-wrapper {
    width: 56px !important;
    height: 56px !important;
    border-radius: 12px !important;
  }

  .alchemy-container .header-menu-icon {
    width: 56px !important;
    height: 56px !important;
    border-radius: 12px !important;
  }

  .alchemy-container .header-menu-item {
    min-height: 75px !important;
    padding: 6px 2px !important;
    gap: 4px !important;
  }

  .alchemy-container .header-menu-label {
    display: none !important;
  }

  .alchemy-container .header-menu-grid {
    gap: 4px !important; /* Стандартный gap как на других страницах */
  }

  .alchemy-hero {
    height: 100vh;
    padding-top: 55px; /* Уменьшенный отступ для мобильных */
    /* Адаптация под вертикальное соотношение 9:16 */
    aspect-ratio: 9 / 16;
  }

  .alchemy-music-toggle {
    top: 65px;
    right: 16px;
    width: 40px;
    height: 40px;
  }

  .alchemy-music-toggle svg {
    width: 20px;
    height: 20px;
  }

  .alchemy-hero-background {
    /* Для мобильных устройств - используем contain, чтобы вся картинка входила без обрезки */
    background-size: contain !important; /* Важно: вся картинка должна входить */
    background-position: center center !important;
    background-color: #0a0a0a !important; /* Черный фон для заполнения пустых областей */
    /* Гарантируем заполнение на мобильных */
    min-width: 100%;
    min-height: 100%;
  }

  .alchemy-hero-greeting {
    bottom: 0;
    padding: 12px 18px;
    width: 95%;
    border-radius: 12px 12px 0 0;
    border-bottom: none;
  }

  .alchemy-hero-greeting.greeting-compact {
    padding: 8px 18px;
  }
  
  .alchemy-interactive-zones {
    padding-bottom: 150px; /* Отступ снизу для мобильных */
  }

  .alchemy-hero-title {
    font-size: 20px;
    letter-spacing: 2px;
  }
  
  .alchemy-hero-subtitle {
    font-size: 14px;
    letter-spacing: 0.5px;
  }

  /* Интерактивные зоны на мобильных - полностью невидимые, но кликабельные */
  .artifact-zone {
    visibility: visible; /* Элемент виден для браузера, чтобы получать события */
    border: none; /* Нет границ */
    background: transparent; /* Прозрачный фон */
  }

  /* Адаптация диалога зеркала для мобильных */
  .action-zone-mirror {
    gap: 12px;
    padding: 20px;
  }
  
  .action-zone-mirror.action-zone-content {
    padding: 20px;
    padding-top: 30px;
  }
  
  .action-zone-mirror {
    padding-top: 30px;
  }

  .mirror-dialog-messages {
    min-height: 120px;
    max-height: calc(100vh - 380px);
    padding: 10px;
    gap: 10px;
    margin-top: 10px;
  }

  .mirror-message {
    padding: 12px 16px;
    border-radius: 14px;
    font-size: 14px;
  }

  .mirror-message p {
    font-size: 14px;
    line-height: 1.5;
  }

  .mirror-message-user {
    margin-left: 15px;
    width: calc(100% - 15px);
    max-width: calc(100% - 15px);
  }

  .mirror-input-container {
    padding: 15px 0;
    gap: 8px;
    width: 100%;
    box-sizing: border-box;
  }

  .mirror-input {
    padding: 10px 14px;
    font-size: 14px;
  }

  .mirror-send-btn {
    width: 40px;
    height: 40px;
  }

  .mirror-send-btn svg {
    width: 18px;
    height: 18px;
  }

  .artifact-zone:active {
    background: transparent; /* Остается невидимой */
    border: none; /* Нет границ */
    transform: none; /* Без трансформации */
  }

  .artifact-zone::after {
    bottom: 8%; /* Располагаем подпись ближе к нижнему краю зоны на мобильных */
    left: 50%;
    transform: translateX(-50%); /* Центрируем по горизонтали */
    font-size: 11px;
    padding: 5px 10px;
    opacity: 0.95; /* Хорошо видимая на мобильных */
    visibility: visible; /* Явно делаем видимой */
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 215, 0, 0.6);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.8), 0 0 12px rgba(255, 215, 0, 0.4);
  }

  /* Позиции artifact-zone универсальны для всех устройств (используются проценты с соотношением 9:16) */
  
  .alchemy-hero-subtitle {
    font-size: 14px;
    letter-spacing: 0.5px;
  }

  .action-zone {
    padding: 100px 16px 100px; /* Увеличен padding-top для header на мобильных (10px padding + 56px иконка + 6px padding + запас) */
  }
  
  /* Для астролябии на планшетах - увеличиваем padding-top */
  .action-zone-astrolabe {
    padding-top: 100px !important;
  }

  .action-zone-content {
    padding: 30px 20px;
  }
  
  /* Увеличиваем высоту контейнера для карт Таро на планшетах */
  .action-zone-inner {
    max-height: calc(100vh - 100px); /* Увеличена высота для планшетов */
    min-height: calc(100vh - 100px); /* Минимальная высота для планшетов */
  }
  
  .action-zone-tarot .action-zone-content {
    min-height: 800px; /* Минимальная высота для размещения всех карт на планшетах */
  }

  .action-zone-snitch .action-zone-content {
    min-height: 900px; /* Минимальная высота для размещения всех карточек на планшетах */
  }
  
  /* Для астролябии (калькулятора) на планшетах - убираем ограничение высоты */
  .action-zone-astrolabe .action-zone-inner {
    max-height: none !important;
    min-height: auto !important;
    height: auto !important;
    overflow-y: visible !important;
  }

  .action-zone-title {
    font-size: 22px;
  }

  .action-zone-content .action-zone-text {
    font-size: 14px;
  }

  .action-zone-input {
    padding: 12px 16px;
    font-size: 14px;
  }

  .action-zone-button {
    padding: 12px 24px;
    font-size: 14px;
  }

  /* Таро: всегда 3 карты в ряд, размер ужимается под ширину контейнера */
  .tarot-cards-container {
    grid-template-columns: repeat(3, 1fr);
    gap: clamp(6px, 2.2vw, 12px);
    width: 100%;
    max-width: 100%;
    margin-left: auto;
    margin-right: auto;
    box-sizing: border-box;
  }

  .tarot-card-wrapper {
    width: 100%;
    max-width: 100%;
    min-height: 0;
    height: auto;
    aspect-ratio: 2/3;
  }
  
  .tarot-card-inner {
    min-height: 0;
    height: 100%;
  }
  
  .tarot-card-front,
  .tarot-card-back {
    min-height: 0;
    height: 100%;
  }
  
  .tarot-card-image {
    min-height: 0;
    height: 100%;
  }

  /* Амулеты: оставляем текущее мобильное поведение (в 1 колонку) */
  .amulets-container {
    grid-template-columns: 1fr;
    gap: 16px;
    max-width: 450px;
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    box-sizing: border-box;
  }
  
  .tarot-result {
    padding: 20px;
    margin-top: 30px;
  }
  
  .tarot-result-text {
    font-size: 14px;
    line-height: 1.6;
  }

  /* Увеличиваем высоту контейнера для карт Таро на мобильных */
  .action-zone.action-zone-tarot {
    overflow-y: auto !important; /* Разрешаем прокрутку для карт */
    overflow-x: hidden !important;
    height: auto !important; /* Автоматическая высота */
    min-height: 100vh !important; /* Минимальная высота экрана */
    max-height: none !important; /* Убираем ограничение высоты */
  }

  /* Увеличиваем высоту контейнера для геймификации обучения на мобильных */
  .action-zone.action-zone-snitch {
    overflow-y: auto !important; /* Разрешаем прокрутку для карточек */
    overflow-x: hidden !important;
    height: auto !important; /* Автоматическая высота */
    min-height: 100vh !important; /* Минимальная высота экрана */
    max-height: none !important; /* Убираем ограничение высоты */
  }
  
  .action-zone-inner {
    max-height: none !important; /* Убираем ограничение высоты для мобильных */
    min-height: auto !important; /* Автоматическая минимальная высота */
    height: auto !important; /* Автоматическая высота */
    overflow-y: visible !important; /* Разрешаем показ всего контента */
    padding-bottom: 200px !important; /* Увеличенный отступ снизу для карт */
  }
  
  /* Для астролябии (калькулятора) на мобильных - убираем ограничение высоты и включаем прокрутку */
  .action-zone-astrolabe {
    overflow-y: auto !important; /* Включаем прокрутку для астролябии */
    overflow-x: hidden !important;
    height: 100vh !important;
    max-height: 100vh !important;
    -webkit-overflow-scrolling: touch; /* Плавная прокрутка на iOS */
  }
  
  .action-zone-astrolabe .action-zone-inner {
    max-height: none !important;
    min-height: auto !important;
    height: auto !important;
    overflow-y: visible !important;
    overflow-x: hidden !important;
    padding-bottom: 150px !important; /* Отступ снизу для кнопки */
    display: flex !important;
    flex-direction: column !important;
  }
  
  /* Убеждаемся, что контент калькулятора виден и прокручивается */
  .action-zone-astrolabe .matrix-calculator-wrapper {
    width: 100% !important;
    overflow: visible !important;
    min-height: fit-content !important;
  }
  
  .action-zone-astrolabe .results-container {
    width: 100% !important;
    overflow: visible !important;
    min-height: fit-content !important;
  }
  
  .action-zone-tarot .action-zone-content,
  .action-zone-content.action-zone-tarot {
    min-height: 650px !important; /* Минимальная высота для размещения всех карт (3 карты по 180px + отступы + текст) */
    padding: 30px 20px !important;
    overflow: visible !important; /* Разрешаем показ всего контента */
    max-height: none !important; /* Убираем ограничение высоты */
    display: flex !important; /* Принудительно делаем flex */
    flex-direction: column !important; /* Вертикальное направление */
  }

  .action-zone-snitch .action-zone-content,
  .action-zone-content.action-zone-snitch {
    min-height: 700px !important; /* Минимальная высота для размещения всех карточек (4 карточки + отступы + текст) */
    padding: 30px 20px !important;
    overflow: visible !important; /* Разрешаем показ всего контента */
    max-height: none !important; /* Убираем ограничение высоты */
    display: flex !important; /* Принудительно делаем flex */
    flex-direction: column !important; /* Вертикальное направление */
  }
  
  .tarot-cards-container {
    display: grid !important; /* Принудительно делаем grid */
    visibility: visible !important; /* Принудительно делаем видимым */
    opacity: 1 !important; /* Принудительно делаем непрозрачным */
    min-height: 0 !important;
  }
  
  .tarot-card-wrapper {
    display: block !important; /* Принудительно делаем блочным */
    visibility: visible !important; /* Принудительно делаем видимым */
    opacity: 1 !important; /* Принудительно делаем непрозрачным */
  }

  .back-to-table-button {
    bottom: 12px;
    padding: 12px 30px;
    font-size: 14px;
  }
}

/* Адаптивность для очень маленьких экранов */
@media (max-width: 480px) {
  /* Дополнительные стили для Header на очень маленьких экранах */
  .alchemy-container .header-block {
    background: rgba(20, 20, 30, 0.075) !important; /* Прозрачность в 2 раза меньше */
    padding: 8px 12px 4px 12px !important; /* Стандартный padding как на других страницах */
  }

  .alchemy-container .header-menu-icon-wrapper {
    width: 48px !important;
    height: 48px !important;
    border-radius: 10px !important;
  }

  .alchemy-container .header-menu-icon {
    width: 48px !important;
    height: 48px !important;
    border-radius: 10px !important;
  }

  .alchemy-container .header-menu-item {
    min-height: 70px !important;
    padding: 4px 1px !important;
    gap: 3px !important;
  }

  .alchemy-container .header-menu-label {
    display: none !important;
  }

  .alchemy-container .header-menu-grid {
    gap: 3px !important; /* Стандартный gap как на других страницах */
  }

  .alchemy-hero {
    padding-top: 50px; /* Еще меньший отступ для очень маленьких экранов */
  }

  .action-zone {
    padding: 90px 12px 100px; /* Отступ для header на очень маленьких экранах (8px padding + 70px min-height + 4px padding + запас) */
  }
  
  /* Для астролябии на мобильных - увеличиваем padding-top чтобы не заезжала под верхнюю панель */
  .action-zone-astrolabe {
    padding-top: 90px !important;
  }

  .alchemy-music-toggle {
    top: 60px;
    right: 12px;
    width: 36px;
    height: 36px;
  }

  .alchemy-music-toggle svg {
    width: 18px;
    height: 18px;
  }

  .alchemy-hero-greeting {
    bottom: 0;
    padding: 10px 15px;
    width: 95%;
    border-radius: 10px 10px 0 0;
    border-bottom: none;
  }

  .alchemy-hero-greeting.greeting-compact {
    padding: 6px 15px;
  }

  .alchemy-hero-title {
    font-size: 18px;
    letter-spacing: 1.5px;
  }
  
  .alchemy-hero-subtitle {
    font-size: 12px;
    letter-spacing: 0.3px;
  }
  
  .alchemy-interactive-zones {
    padding-bottom: 130px; /* Отступ снизу для очень маленьких экранов */
  }
  /* Позиции artifact-zone универсальны для всех устройств (используются проценты с соотношением 9:16) */

  .action-zone-title {
    font-size: 20px;
  }

  .action-zone-content .action-zone-text {
    font-size: 13px;
  }

  /* Дополнительные стили для диалога зеркала на очень маленьких экранах */
  .action-zone-mirror {
    gap: 12px;
    padding: 15px;
    padding-top: 25px;
  }

  .mirror-dialog-messages {
    min-height: 120px;
    max-height: calc(100vh - 320px);
    padding: 6px;
    gap: 8px;
    margin-top: 10px;
  }

  .mirror-message {
    padding: 10px 12px;
    border-radius: 12px;
  }

  .mirror-message p {
    font-size: 13px;
    line-height: 1.4;
  }

  .mirror-message-user {
    margin-left: 8px;
    width: calc(100% - 8px);
    max-width: calc(100% - 8px);
  }

  .mirror-input-container {
    padding: 12px 0;
    gap: 6px;
    width: 100%;
    box-sizing: border-box;
  }

  .mirror-input {
    padding: 8px 12px;
    font-size: 13px;
  }

  .mirror-send-btn {
    width: 36px;
    height: 36px;
  }

  .mirror-send-btn svg {
    width: 16px;
    height: 16px;
  }
}

/* Темный режим (для свечи) */
.alchemy-container.dark-mode {
  background: #000000 !important;
}

.alchemy-container.dark-mode .alchemy-hero-background {
  opacity: 0.3 !important; /* Приглушаем фон при темном режиме */
  filter: brightness(0.2) !important;
}

/* Явное восстановление фона когда темный режим выключен */
.alchemy-container:not(.dark-mode) .alchemy-hero-background {
  opacity: 1 !important;
  filter: none !important;
}

/* Анимация появления света при возврате из блока свечи */
@keyframes lightAppearing {
  0% {
    opacity: 0.3;
    filter: brightness(0.2);
  }
  50% {
    opacity: 0.6;
    filter: brightness(0.6);
  }
  100% {
    opacity: 1;
    filter: brightness(1);
  }
}

.alchemy-hero-background.light-appearing {
  animation: lightAppearing 2s ease-in-out forwards;
}

.alchemy-container.dark-mode .action-zone {
  background: #000000;
}

/* Стили для текста блока свечи - без контейнера, на черном фоне */
.action-zone-candle-text {
  background: transparent;
  padding: 40px 20px;
  text-align: center;
  animation: fadeInContent 0.5s ease-in-out;
}

.action-zone-candle-title {
  color: #8B6914; /* Темно-золотой цвет */
  font-size: 32px;
  font-weight: 700;
  margin: 0 0 20px;
  text-shadow: 0 0 20px rgba(139, 105, 20, 0.5);
}

.action-zone-candle-description {
  color: #8B6914; /* Темно-золотой цвет */
  font-size: 18px;
  line-height: 1.8;
  margin: 0;
  text-shadow: 0 0 15px rgba(139, 105, 20, 0.4);
}

/* Мобильные стили для блока свечи */
@media (max-width: 768px) {
  .action-zone-candle-text {
    padding: 30px 16px;
  }
  
  .action-zone-candle-description {
    font-size: 16px;
    line-height: 1.6;
  }
}

@media (max-width: 480px) {
  .action-zone-candle-text {
    padding: 20px 12px;
  }
  
  .action-zone-candle-description {
    font-size: 14px;
    line-height: 1.5;
  }
}

.alchemy-container.dark-mode .action-zone-content {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(255, 255, 255, 0.2);
}

.alchemy-container.dark-mode .action-zone-title,
.alchemy-container.dark-mode .action-zone-text {
  color: #ffffff;
}

.alchemy-container.dark-mode .action-zone-input {
  background: rgba(255, 255, 255, 0.1);
  border-color: rgba(255, 255, 255, 0.2);
  color: #ffffff;
}

.alchemy-container.dark-mode .action-zone-button {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.15));
  border-color: rgba(255, 255, 255, 0.4);
  color: #ffffff;
}

.alchemy-container.dark-mode .action-zone-button:hover {
  background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), rgba(255, 255, 255, 0.25));
  border-color: rgba(255, 255, 255, 0.6);
}

/* Стили для диалога зеркала */
.action-zone-mirror {
  display: flex;
  flex-direction: column;
  gap: 15px;
  box-sizing: border-box;
  min-height: 0;
  flex: 1;
  overflow: hidden;
  padding: 30px;
  width: 100%;
  max-width: 100%;
}

.mirror-dialog-messages {
  display: flex;
  flex-direction: column;
  gap: 12px;
  min-height: 150px;
  max-height: calc(100vh - 420px);
  overflow-y: auto;
  overflow-x: hidden;
  padding: 15px;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(25px);
  border-radius: 16px;
  border: 1px solid rgba(255, 215, 0, 0.25);
  margin-bottom: 10px;
  height: auto;
  flex: 1;
  min-height: 0;
  box-sizing: border-box;
  width: 100%;
  scroll-padding-top: 10px;
  box-shadow: 
    0 8px 32px rgba(0, 0, 0, 0.6),
    inset 0 0 60px rgba(255, 215, 0, 0.08),
    inset 0 0 100px rgba(138, 43, 226, 0.05);
}

.mirror-dialog-messages::-webkit-scrollbar {
  width: 6px;
}

.mirror-dialog-messages::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 3px;
}

.mirror-dialog-messages::-webkit-scrollbar-thumb {
  background: rgba(255, 215, 0, 0.3);
  border-radius: 3px;
}

.mirror-dialog-messages::-webkit-scrollbar-thumb:hover {
  background: rgba(255, 215, 0, 0.5);
}

.mirror-message {
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.15);
  border-radius: 18px;
  padding: 14px 18px;
  position: relative;
  box-shadow: 
    0 4px 12px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
  animation: messageAppear 0.4s ease-out;
  min-height: 50px;
  box-sizing: border-box;
  flex-shrink: 0;
  width: 100%;
  max-width: 100%;
  word-wrap: break-word;
  overflow-wrap: break-word;
  overflow: hidden;
}

.mirror-message-user {
  background: linear-gradient(135deg, rgba(255, 215, 0, 0.25), rgba(255, 165, 0, 0.2));
  border-color: rgba(255, 215, 0, 0.4);
  margin-left: 20px;
  margin-right: 0;
  width: calc(100% - 20px);
  max-width: calc(100% - 20px);
  box-shadow: 
    0 4px 12px rgba(0, 0, 0, 0.3),
    0 0 20px rgba(255, 215, 0, 0.2),
    inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.mirror-message-assistant {
  background: rgba(255, 255, 255, 0.08);
  border-color: rgba(255, 255, 255, 0.15);
  box-shadow: 
    0 4px 12px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.mirror-message::before {
  content: '';
  position: absolute;
  left: -8px;
  top: 24px;
  width: 0;
  height: 0;
  border-top: 8px solid transparent;
  border-bottom: 8px solid transparent;
  border-right: 8px solid rgba(255, 255, 255, 0.1);
}

.mirror-message::after {
  content: '';
  position: absolute;
  left: -7px;
  top: 24px;
  width: 0;
  height: 0;
  border-top: 8px solid transparent;
  border-bottom: 8px solid transparent;
  border-right: 8px solid rgba(255, 255, 255, 0.2);
}

.mirror-message-user::before,
.mirror-message-user::after {
  display: none;
}

.mirror-message p {
  color: rgba(255, 255, 255, 0.95);
  font-size: 15px;
  line-height: 1.7;
  margin: 0;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  white-space: pre-wrap;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.mirror-input-container {
  display: flex;
  gap: 12px;
  align-items: center;
  flex-shrink: 0;
  padding: 20px 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  margin-top: auto;
  background: transparent;
  backdrop-filter: none;
  z-index: 10;
  position: relative;
  width: 100%;
  box-sizing: border-box;
}

.mirror-input {
  flex: 1;
  background: rgba(255, 255, 255, 0.08);
  border: 1px solid rgba(255, 215, 0, 0.3);
  border-radius: 12px;
  padding: 12px 16px;
  color: #ffffff;
  font-size: 14px;
  font-family: inherit;
  transition: all 0.3s ease;
}

.mirror-input:focus {
  outline: none;
  border-color: rgba(255, 215, 0, 0.5);
  background: rgba(255, 255, 255, 0.12);
  box-shadow: 0 0 0 3px rgba(255, 215, 0, 0.1);
}

.mirror-input::placeholder {
  color: rgba(255, 255, 255, 0.4);
}

.mirror-input:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.mirror-send-btn {
  background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(255, 165, 0, 0.25));
  border: 1px solid rgba(255, 215, 0, 0.5);
  border-radius: 12px;
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #FFD700;
  flex-shrink: 0;
  box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
}

.mirror-send-btn:hover:not(:disabled) {
  transform: scale(1.05);
  box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
  background: linear-gradient(135deg, rgba(255, 215, 0, 0.4), rgba(255, 165, 0, 0.35));
  border-color: rgba(255, 215, 0, 0.7);
}

.mirror-send-btn:active:not(:disabled) {
  transform: scale(0.98);
}

.mirror-send-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

@keyframes messageAppear {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Илья: Стили для тестов */
/* Контейнер для сетки */
.tests-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-top: 20px;
}

/* Стили карточки */
.test-card {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

.test-card:hover {
  transform: translateY(-5px);
  background: rgba(255, 255, 255, 0.1);
  border-color: #00f2ff; /* Цвет кристалла */
  box-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
}

.test-card-icon {
  font-size: 2rem;
  margin-bottom: 10px;
}

.test-card-title {
  font-size: 1.1rem;
  color: #fff;
  margin-bottom: 5px;
}

.test-card-desc {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
}

.test-card-badge {
  margin-top: 10px;
  font-size: 0.7rem;
  background: rgba(0, 242, 255, 0.2);
  color: #00f2ff;
  padding: 2px 8px;
  border-radius: 10px;
}

/* Адаптивность для мобилок */
@media (max-width: 600px) {
  .tests-grid {
    grid-template-columns: 1fr;
  }
}

/* Золотистое свечение Снитча */
.action-zone-snitch {
  background: radial-gradient(circle at center, rgba(255, 215, 0, 0.15) 0%, transparent 75%);
}

.novella-card {
  border: 1px solid rgba(255, 215, 0, 0.3) !important;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  background: linear-gradient(145deg, rgba(30, 30, 30, 0.9), rgba(10, 10, 10, 0.95)) !important;
}

/* Эффект "активной" демонстрации */
.novella-card.active-demo {
  border-color: #FFD700 !important;
  box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
}

.novella-badge {
  position: absolute;
  top: 12px;
  right: -30px;
  background: #FFD700;
  color: #000;
  padding: 4px 35px;
  font-size: 10px;
  font-weight: 800;
  transform: rotate(45deg);
}

.novella-badge.feature {
  background: rgba(255, 255, 255, 0.2);
  color: #fff;
}

.novella-start-btn {
  margin-top: auto;
  background: #FFD700;
  color: #000;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
}

/* Кристалл - технологичный неон */
.action-zone-tarot .test-card {
  border: 1px solid rgba(0, 242, 255, 0.2) !important;
  background: rgba(10, 20, 30, 0.8) !important;
}

.action-zone-tarot .test-card:hover {
  border-color: #00f2ff !important;
  box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);
}

.action-zone-tarot .test-card-badge {
  background: rgba(0, 242, 255, 0.2);
  color: #00f2ff;
}

.test-card.custom-request {
  background: linear-gradient(145deg, rgba(0, 242, 255, 0.05), rgba(10, 20, 30, 0.9)) !important;
  border: 1px dashed rgba(0, 242, 255, 0.4) !important;
}